# QuestGear 3D Ecosystem - Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         QUEST 3 HEADSET                                  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  QuestGear3DScan (Unity App)                                    â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â€¢ Captures Camera 1 (tracking) â†’ 1280x720 JPG                 â”‚    â”‚
â”‚  â”‚  â€¢ Reads Environment Depth API â†’ 320x320 PNG (16-bit)          â”‚    â”‚
â”‚  â”‚  â€¢ Tracks HMD pose (6DOF) â†’ Position + Rotation                â”‚    â”‚
â”‚  â”‚  â€¢ Exports transforms.json (NerfStudio format)                 â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  Output: Scan_YYYYMMDD_HHMMSS/                                 â”‚    â”‚
â”‚  â”‚    â”œâ”€â”€ color/frame_*.jpg                                        â”‚    â”‚
â”‚  â”‚    â”œâ”€â”€ depth/frame_*.png                                        â”‚    â”‚
â”‚  â”‚    â”œâ”€â”€ scan_data.json                                           â”‚    â”‚
â”‚  â”‚    â””â”€â”€ transforms.json  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                    USB Transfer / ADB    â”‚
                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WINDOWS PC                                       â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  QuestGear3DStudio (Python/Flet GUI)                            â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  Data Adapter (quest_adapter.py)                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Auto-detects new vs legacy format                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Converts scan_data.json â†’ frames.json                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Extracts camera intrinsics                            â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                           â–¼                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  Image Processor (quest_image_processor.py)              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Loads JPG/PNG (new) or YUV/RAW (legacy)               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Validates depth quality                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Detects uniform/placeholder depth                     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                           â–¼                                      â”‚    â”‚
â”‚  â”‚         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                â”‚    â”‚
â”‚  â”‚         â•‘  RECONSTRUCTION PATH SELECTOR         â•‘                â”‚    â”‚
â”‚  â”‚         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                â”‚    â”‚
â”‚  â”‚                  /                    \                          â”‚    â”‚
â”‚  â”‚          Valid Depth?                  No Valid Depth            â”‚    â”‚
â”‚  â”‚                /                              \                  â”‚    â”‚
â”‚  â”‚               â–¼                                â–¼                 â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ TSDF Reconstruction      â”‚   â”‚ NerfStudio Training        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ (reconstruction.py)      â”‚   â”‚ (nerfstudio_trainer.py)    â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                          â”‚   â”‚                            â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ VoxelBlockGrid (CUDA)  â”‚   â”‚ â€¢ Subprocess: ns-train     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Depth fusion           â”‚   â”‚ â€¢ Methods:                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Mesh extraction        â”‚   â”‚   - Splatfacto â­         â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Post-processing        â”‚   â”‚   - Nerfacto              â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                          â”‚   â”‚   - Instant-NGP           â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Output: .ply mesh        â”‚   â”‚ â€¢ Progress tracking       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                          â”‚   â”‚ â€¢ Real-time logs          â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                          â”‚   â”‚                            â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                          â”‚   â”‚ Output: .ply gaussians     â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                  â”‚                              â”‚                â”‚    â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚    â”‚
â”‚  â”‚                            â–¼                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  3D Viewer / Export                                      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Open3D visualization                                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Export to OBJ, PLY, GLB                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ NerfStudio viewer integration (port 7007)            â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  Optional: NerfStudio Standalone                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  $ ns-train splatfacto --data Scan_20260215_221412/            â”‚    â”‚
â”‚  â”‚  â†’ Training on GPU... (5-10 min)                                â”‚    â”‚
â”‚  â”‚  â†’ Viewer: http://localhost:7007                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### ğŸ“¸ Capture (Quest 3)
```
HMD Movement â†’ Pose Tracking (6DOF)
              + Camera 1 (color images)
              + Environment Depth API
              â†“
              scan_data.json + transforms.json + images
```

### ğŸ”„ Processing (PC)
```
1. Load Scan â†’ quest_adapter.detect_scan_format()
               â”œâ”€ "new" â†’ _adapt_new_format()
               â””â”€ "old" â†’ _adapt_old_format()
               â†“
               frames.json (unified format)

2. Load Images â†’ quest_image_processor.process_quest_frame()
                 â”œâ”€ .jpg/.png â†’ cv2.imread()
                 â””â”€ .yuv â†’ yuv420_to_rgb()
                 â†“
                 RGB + Depth arrays

3. Validate Depth â†’ reconstruction.integrate_frame()
                    â”œâ”€ All zeros? â†’ Skip
                    â”œâ”€ All same value? â†’ Skip (placeholder)
                    â””â”€ Valid variation â†’ Integrate to TSDF
                    
                    IF no valid depth:
                    â†“
                    generate_color_only.py
                    â”œâ”€ camera_trajectory.ply
                    â””â”€ COLOR_ONLY_OPTIONS.md

4. Reconstruction:
   â”œâ”€ TSDF Path (if depth valid)
   â”‚  â””â”€ VoxelBlockGrid â†’ Mesh (.ply)
   â”‚
   â””â”€ NerfStudio Path (color-only)
      â”œâ”€ nerfstudio_trainer.start_training()
      â”œâ”€ Parse logs (progress tracking)
      â””â”€ Gaussian Splatting (.ply) or NeRF weights
```

### ğŸ“Š Output Formats

| Method | Output | File Size | Pros | Cons |
|--------|--------|-----------|------|------|
| TSDF | Mesh (.ply) | 5-50 MB | Clean geometry | Needs depth |
| Splatfacto | Gaussians (.ply) | 50-500 MB | Photorealistic | Large file |
| Nerfacto | NeRF weights | 10-20 MB | Compact | Slow inference |

---

## Key Integration Points

### 1. Format Detection
**File:** `modules/quest_adapter.py`
```python
format_type = QuestDataAdapter.detect_scan_format(scan_dir)
# Returns: 'new' or 'old'
```

### 2. Depth Validation
**File:** `modules/reconstruction.py`
```python
# Check for uniform depth (placeholder)
unique_values = np.unique(depth_image[valid_mask])
if len(unique_values) == 1:
    # Skip - invalid depth
```

### 3. NerfStudio Training
**File:** `modules/nerfstudio_trainer.py`
```python
trainer = NerfStudioTrainer()
trainer.start_training(
    data_path=scan_path,
    method='splatfacto',
    progress_callback=on_progress,
    completion_callback=on_complete
)
```

---

*Architecture v2.0 | 2026-02-15*
